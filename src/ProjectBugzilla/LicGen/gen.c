#include <stdio.h>
#include <string.h>

#define LEN 322

char private[LEN] = {
		0xE9,0xCD,0x30,0x9C,0x52,0x9F,0x42,0x52,0xA6,0x36,
		0x4B,0x1A,0x00,0x2F,0x2C,0x5F,0x81,0xD7,0x4D,0x33,
		0xBF,0x48,0xFF,0x8E,0x12,0xF6,0x30,0x34,0x94,0x0A,
		0x70,0x35,0x46,0x5B,0x1F,0x59,0xDE,0x4D,0xCA,0xB3,
		0x46,0xD7,0x48,0xD1,0x1C,0xF3,0x8D,0x58,0xF8,0x59,
		0x25,0xB1,0x97,0x45,0xB2,0xB6,0x57,0x53,0xE6,0xD1,
		0x09,0x30,0x16,0x6E,0x7D,0xA1,0xD8,0x3D,0x11,0x4C,
		0xDC,0xAC,0xAD,0x99,0x96,0x24,0xC0,0x10,0x67,0xE8,
		0xBF,0x48,0xFF,0x8E,0x12,0xF6,0x30,0x34,0x94,0x0A,
		0xD1,0x8D,0x46,0xBC,0x82,0x45,0xDF,0xA2,0xD5,0xD6,
		0x7A,0x9E,0xC1,0x10,0xEA,0x45,0xDF,0xA2,0xD5,0xD6, 
		0xBF,0x48,0xFF,0x8E,0x12,0xF6,0x30,0x34,0x94,0x0A,
		0x25,0xB1,0x97,0x45,0xB2,0xB6,0x57,0x53,0xE6,0xD1,
		0x7A,0x9E,0xC1,0x10,0xEA,0x45,0xDF,0xA2,0xD5,0xD6, 
		0xBF,0x48,0xFF,0x8E,0x12,0xF6,0x30,0x34,0x94,0x0A,
		0xBF,0x48,0xFF,0x8E,0x12,0xF6,0x30,0x34,0x94,0x0A,
		0xD1,0x8D,0x46,0xBC,0x82,0x45,0xDF,0xA2,0xD5,0xD6,
		0x4B,0x1A,0x00,0x2F,0x2C,0x5F,0x81,0xD7,0x4D,0x33,
		0x0D,0x42,0xED,0xF6,0x52,0x1D,0x4B,0xC3,0x83,0x7E,
		0x8B,0x3B,0x23,0xAB,0xEF,0xAC,0xFC,0x80,0x83,0xCD,
		0x8B,0x3B,0x23,0xAB,0xEF,0xAC,0xFC,0x80,0x83,0xCD,
		0x0D,0x42,0xED,0xF6,0x52,0x1D,0x4B,0xC3,0x83,0x7E,
		0x58,0x43,0x46,0x83,0xC8,0xCF,0x91,0x48,0xEF,0x1E,
		0xBF,0x48,0xFF,0x8E,0x12,0xF6,0x30,0x34,0x94,0x0A,
		0x0D,0x42,0xED,0xF6,0x52,0x1D,0x4B,0xC3,0x83,0x7E,
		0x7A,0x9E,0xC1,0x10,0xEA,0x45,0xDF,0xA2,0xD5,0xD6, 
		0xBF,0x48,0xFF,0x8E,0x12,0xF6,0x30,0x34,0x94,0x0A,
		0xD1,0x8D,0x46,0xBC,0x82,0x45,0xDF,0xA2,0xD5,0xD6,
		0x4B,0x1A,0x00,0x2F,0x2C,0x5F,0x81,0xD7,0x4D,0x33,
		0x0D,0x42,0xED,0xF6,0x52,0x1D,0x4B,0xC3,0x83,0x7E,
		0x8B,0x3B,0x23,0xAB,0xEF,0xAC,0xFC,0x80,0x83,0xCD,
		0x58,0x43,0x46,0x83,0xC8,0xCF,0x91,0x48,0xEF,0x1E,
		0x2D,0x00};

void Generate(char email[LEN], char name[LEN], char company[LEN], char file[LEN])
{
	char repeatEmail[LEN];
	char key[LEN];
	int emailLen = 0;
	int i = 0;
	FILE *f;
	
	f = fopen(file, "w");
	fprintf(f, "<?xml version=\"1.0\" encoding=\"us-ascii\"?>\n");
	fprintf(f, "<!DOCTYPE license>\n");
	fprintf(f, "<license>\n");
    fprintf(f, "    <key>");
	emailLen = strlen(email);
	for (i = 0; i < LEN; i++)
	{
		repeatEmail[i] = email[i%emailLen];
	}
	repeatEmail[LEN-1] = '\0';

	
	for (i = 0; i < LEN; i++)
	{
		unsigned char c = (private[i] + repeatEmail[i]) % 256;
		fprintf(f, "%02x",c);
	}
	key[LEN-1] = '\0';
	fprintf(f, "</key>\n");
	fprintf(f, "    <name>%s</name>\n", name);
	fprintf(f, "    <email>%s</email>\n", email);
    fprintf(f, "    <company>%s</company>\n", company);
	fprintf(f, "</license>\n");
	fclose(f);
}

int main (int argc, char *argv[])
{
	if (5 != argc)
	{
		printf("gen <email> <name> <company> <file>\n");
	}
	else
	{
		Generate(argv[1], argv[2], argv[3], argv[4]);
	}

	return(0);
}
